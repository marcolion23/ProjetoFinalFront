<mat-card class="fornecedor-card">

  <mat-card-title>Cadastro de Fornecedor</mat-card-title>

  <form class="fornecedor-form" #formFornecedor="ngForm">

    <!-- 1. ESTADO com nome completo -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Estado</mat-label>
      <mat-select [(ngModel)]="fornecedor.estado" name="estado" required #estado="ngModel"
                  (selectionChange)="onEstadoChange($event.value)">
        <mat-option *ngFor="let estado of estadosECidades" [value]="estado.nome">
          {{ estado.nome }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="estado.invalid && estado.touched">Estado é obrigatório</mat-error>
    </mat-form-field>

    <!-- 2. CIDADE com filtro funcional -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Cidade</mat-label>
      <mat-select [(ngModel)]="fornecedor.cidade" name="cidade" required #cidade="ngModel" panelClass="cidade-select-panel">
        <!-- Campo de busca -->
        <mat-option disabled>
          <mat-form-field style="width: 100%; margin: 0;">
            <input matInput placeholder="Buscar cidade" (input)="onBuscaCidadeInput($event)" autocomplete="off" />
          </mat-form-field>
        </mat-option>

        <!-- Cidades filtradas -->
        <mat-option *ngFor="let cidade of cidadesFiltradas" [value]="cidade">
          {{ cidade }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="cidade.invalid && cidade.touched">Cidade é obrigatória</mat-error>
    </mat-form-field>

    <!-- 3. RUA - bloquear números digitados -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Rua</mat-label>
      <input matInput placeholder="Rua (sem número)" [(ngModel)]="fornecedor.rua" name="rua" required #rua="ngModel"
             pattern="^[A-Za-zÀ-ÿ\s]+$" (keydown)="bloquearNumeros($event)" />
      <mat-error *ngIf="rua.invalid && rua.touched">Informe apenas letras e espaços</mat-error>
    </mat-form-field>

    <!-- 4. NÚMERO -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Número</mat-label>
      <input matInput type="number" placeholder="Número" [(ngModel)]="fornecedor.numero" name="numero" required #numero="ngModel" />
      <mat-error *ngIf="numero.invalid && numero.touched">Número é obrigatório</mat-error>
    </mat-form-field>

    <!-- 5. BAIRRO -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Bairro</mat-label>
      <input matInput placeholder="Bairro" [(ngModel)]="fornecedor.bairro" name="bairro" required #bairro="ngModel"
             pattern="^[A-Za-zÀ-ÿ\s]+$" (ngModelChange)="capitalizeFirst($event, 'bairro')" />
      <mat-error *ngIf="bairro.invalid && bairro.touched">Informe apenas letras e espaços</mat-error>
    </mat-form-field>

    <!-- 6. CEP -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>CEP</mat-label>
      <input matInput placeholder="00000-000" [(ngModel)]="fornecedor.cep" name="cep" required #cep="ngModel"
             [textMask]="{mask: cepMask, guide: true}" />
      <mat-error *ngIf="cep.invalid && cep.touched">CEP inválido</mat-error>
    </mat-form-field>

    <!-- 7. NOME com capitalização -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Nome</mat-label>
      <input matInput placeholder="Nome do fornecedor" [(ngModel)]="fornecedor.nome" name="nome" required #nome="ngModel"
             pattern="^[A-Za-zÀ-ÿ\s]+$" (ngModelChange)="capitalizeFirst($event, 'nome')" />
      <mat-error *ngIf="nome.invalid && nome.touched">Apenas letras e espaços são permitidos</mat-error>
    </mat-form-field>

    <!-- 8. CNPJ -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>CNPJ</mat-label>
      <input matInput placeholder="00.000.000/0000-00" [(ngModel)]="fornecedor.cnpj" name="cnpj" required #cnpj="ngModel"
             [textMask]="{mask: cnpjMask, guide: true}" />
      <mat-error *ngIf="cnpj.invalid && cnpj.touched">CNPJ inválido</mat-error>
    </mat-form-field>

    <!-- 9. INSCRIÇÃO ESTADUAL -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Inscrição Estadual</mat-label>
      <input matInput placeholder="Somente números" [(ngModel)]="fornecedor.inscricaoEstadual" name="inscricaoEstadual"
             maxlength="14" pattern="^[0-9]*$" />
    </mat-form-field>

    <!-- 10. TELEFONE (com dígito a mais) -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Telefone</mat-label>
      <input matInput placeholder="(99) 9 9999-9999" [(ngModel)]="fornecedor.telefone" name="telefone" required #telefone="ngModel"
             [textMask]="{mask: telefoneMask, guide: true}" />
      <mat-error *ngIf="telefone.invalid && telefone.touched">Telefone obrigatório</mat-error>
    </mat-form-field>

    <!-- 11. EMAIL -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Email</mat-label>
      <input matInput type="email" placeholder="email@exemplo.com" [(ngModel)]="fornecedor.email" name="email" required email #email="ngModel" />
      <mat-error *ngIf="email.invalid && email.touched">Email inválido</mat-error>
    </mat-form-field>

    <!-- 12. CONTATO PRINCIPAL -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Contato Principal</mat-label>
      <input matInput placeholder="Nome do contato" [(ngModel)]="fornecedor.contatoPrincipal" name="contatoPrincipal" required #contatoPrincipal="ngModel"
             pattern="^[A-Za-zÀ-ÿ\s]+$" (ngModelChange)="capitalizeFirst($event, 'contatoPrincipal')" />
      <mat-error *ngIf="contatoPrincipal.invalid && contatoPrincipal.touched">Apenas letras e espaços são permitidos</mat-error>
    </mat-form-field>

    <!-- 13. TELEFONE CONTATO (com dígito a mais) -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Telefone do Contato</mat-label>
      <input matInput placeholder="(99) 9 9999-9999" [(ngModel)]="fornecedor.telefoneContato" name="telefoneContato" required #telefoneContato="ngModel"
             [textMask]="{mask: telefoneMask, guide: true}" />
      <mat-error *ngIf="telefoneContato.invalid && telefoneContato.touched">Telefone obrigatório</mat-error>
    </mat-form-field>

    <!-- 14. OBSERVAÇÕES -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Observações</mat-label>
      <textarea matInput placeholder="Informações adicionais" [(ngModel)]="fornecedor.observacoes" name="observacoes" rows="4"></textarea>
    </mat-form-field>

    <!-- 15. STATUS -->
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Status</mat-label>
      <mat-select [(ngModel)]="fornecedor.status" name="status" required #status="ngModel">
        <mat-option [value]="true">Ativo</mat-option>
        <mat-option [value]="false">Inativo</mat-option>
      </mat-select>
      <mat-error *ngIf="status.invalid && status.touched">Status é obrigatório</mat-error>
    </mat-form-field>

    <!-- BOTÕES -->
    <div class="button-container" style="margin-top: 16px;">
      <button mat-raised-button color="primary" (click)="salvar()" [disabled]="formFornecedor.invalid">Salvar</button>
      <button mat-raised-button color="warn" (click)="cancelar()">Cancelar</button>
      <button mat-raised-button color="accent" (click)="limpar()">Limpar</button>
    </div>

  </form>

</mat-card>
