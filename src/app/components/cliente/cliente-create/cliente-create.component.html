<!-- Card que envolve todo o formulário de cadastro -->
<mat-card class="client-card">

  <!-- Título do formulário -->
  <mat-card-title>Cadastro de Cliente</mat-card-title>

  <!-- Início do formulário -->
  <form class="client-form">

    <!-- Campo: Nome Completo -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Nome Completo</mat-label>
      <input
        matInput
        [(ngModel)]="cliente.cliNome"
        name="cliNome"
        #cliNome="ngModel"
        required
        pattern="^[A-Za-zÀ-ÿ\s]+$"
        (ngModelChange)="capitalizeFirst($event, 'cliNome')" />
      <mat-error *ngIf="cliNome.invalid && cliNome.touched">Apenas letras e espaços</mat-error>
    </mat-form-field>

    <!-- Campo: CPF -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>CPF</mat-label>
      <input matInput placeholder="Ex: 123.456.789-00"
             [(ngModel)]="cliente.cliCpf"
             name="cliCpf"
             required>
    </mat-form-field>

    <!-- Campo: Data de Nascimento -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Data de Nascimento</mat-label>
      <input matInput [matDatepicker]="picker"
             placeholder="DD/MM/AAAA"
             [(ngModel)]="cliente.cliDataNascimento"
             name="cliDataNascimento"
             required
             [max]="maxDate">
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <!-- Campo: Telefone -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Telefone</mat-label>
      <input
        matInput
        [(ngModel)]="cliente.cliTelefone"
        name="cliTelefone"
        #cliTelefone="ngModel"
        required
        [textMask]="{mask: telefoneMask, guide: true}" />
      <mat-error *ngIf="cliTelefone.invalid && cliTelefone.touched">Telefone obrigatório</mat-error>
    </mat-form-field>

    <!-- Campo: Email -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Email</mat-label>
      <input
        matInput
        type="email"
        [(ngModel)]="cliente.cliEmail"
        name="cliEmail"
        #cliEmail="ngModel"
        required
        email />
      <mat-error *ngIf="cliEmail.invalid && cliEmail.touched">Email inválido</mat-error>
    </mat-form-field>

 <!-- ESTADO -->
 <mat-form-field appearance="outline" class="half-width" required>
  <mat-label>Estado</mat-label>
  <mat-select
  [(ngModel)]="cliente.cliEstado"
  name="estado"
    #estado="ngModel"
    required
    (selectionChange)="onEstadoChange($event.value)">
    <mat-option *ngFor="let estado of estadosECidades" [value]="estado.nome">
      {{ estado.nome }}
    </mat-option>
  </mat-select>
  <mat-error *ngIf="estado.invalid && estado.touched">Estado é obrigatório</mat-error>
</mat-form-field>

<!-- CIDADE COM FILTRO -->
<mat-form-field appearance="outline" class="half-width" required>
  <mat-label>Cidade</mat-label>
  <mat-select
  [(ngModel)]="cliente.cliCidade"
  name="cidade"
    #cidade="ngModel"
    required
    panelClass="cidade-select-panel"
    (selectionChange)="onCidadeSelecionada($event.value)">
    <mat-option disabled>
      <mat-form-field style="width: 100%; margin: 0;">
        <input matInput placeholder="Buscar cidade" (input)="onBuscaCidadeInput($event)" />
      </mat-form-field>
    </mat-option>
    <mat-option *ngFor="let cidade of cidadesFiltradas" [value]="cidade">{{ cidade }}</mat-option>
  </mat-select>
  <mat-error *ngIf="cidade.invalid && cidade.touched">Cidade é obrigatória</mat-error>
</mat-form-field>

<!-- CAMPO EXTRA PARA OUTRA CIDADE -->
<mat-form-field
*ngIf="mostrarCampoOutraCidade"
appearance="outline"
class="half-width"
required>
<mat-label>Digite o nome da cidade</mat-label>
<input
matInput
[(ngModel)]="nomeOutraCidade"
name="nomeOutraCidade"
#nomeOutraCidadeInput="ngModel"
required
(keydown)="bloquearNumeros($event)"
(ngModelChange)="capitalizeFirst($event, 'cliNome')"
/>
<mat-error *ngIf="nomeOutraCidadeInput.invalid && nomeOutraCidadeInput.touched">
Cidade é obrigatória
</mat-error>
</mat-form-field>



    
    <!-- Campo: Rua -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Rua</mat-label>
      <input matInput placeholder="Ex: Rua das Flores"
             [(ngModel)]="cliente.cliRua"
             name="cliRua"
             required
             (ngModelChange)="capitalizeFirst($event, 'cliRua')">
    </mat-form-field>

    <!-- Campo: Número da residência -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Número</mat-label>
      <input matInput type="number"
             placeholder="Ex: 123"
             [(ngModel)]="cliente.cliNumero"
             name="cliNumero"
             required>
    </mat-form-field>

    <!-- Campo: Bairro -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Bairro</mat-label>
      <input matInput placeholder="Ex: Centro"
             [(ngModel)]="cliente.cliBairro"
             name="cliBairro"
             required
             (ngModelChange)="capitalizeFirst($event, 'cliBairro')">
    </mat-form-field>

    <!-- Campo: CEP -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>CEP</mat-label>
      <input matInput placeholder="Ex: 01234-567"
             [(ngModel)]="cliente.cliCep"
             name="cliCep"
             required>
    </mat-form-field>

    <!-- Campo: Status do Cliente (Ativo ou Inativo) -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Cliente Ativo?</mat-label>
      <mat-select [(ngModel)]="cliente.cliAtivo"
                  name="cliAtivo"
                  required>
        <mat-option [value]="true">Sim</mat-option>
        <mat-option [value]="false">Não</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Botões de Ação -->
    <div class="button-container">
      <button mat-raised-button color="primary" (click)="salvar()">Salvar</button>
      <button mat-raised-button color="warn" (click)="cancel()">Cancelar</button>
      <button mat-raised-button (click)="limpar()">Limpar</button>
    </div>

  </form>
</mat-card>
