
!-- CONTAINER GERAL que empurra todo o conteúdo abaixo do header fixo -->
<div class="container-geral">
<!-- Card principal que envolve todo o formulário -->
<mat-card class="client-card">

  <!-- Título do formulário -->
  <mat-card-title class="titulo-formulario">Cadastro de Cliente</mat-card-title>

  <!-- Formulário Angular -->
  <form class="client-form" #formCliente="ngForm" (ngSubmit)="salvar()" autocomplete="off" novalidate>

    <!-- Nome Completo -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Nome Completo</mat-label>
      <input
        matInput
        name="cliNome"
        [(ngModel)]="cliente.cliNome"
        #cliNome="ngModel"
        maxlength="80"
        required
        pattern="^[A-Za-zÀ-ÿ\s]+$"
        (ngModelChange)="capitalizeFirst('cliNome')"
        autocomplete="off"
      />
      <mat-error *ngIf="cliNome.invalid && cliNome.touched">
        Apenas letras e espaços são permitidos.
      </mat-error>
    </mat-form-field>

    <!-- Campo Sexo -->
<mat-form-field appearance="outline" class="half-width" required>
  <mat-label>Sexo</mat-label>
  <mat-select [(ngModel)]="cliente.cliSexo" name="cliSexo" required #cliSexo="ngModel">
    <mat-option value="masculino">Masculino</mat-option>
    <mat-option value="feminino">Feminino</mat-option>
  </mat-select>
  <mat-error *ngIf="cliSexo.invalid && cliSexo.touched">
    O campo sexo é obrigatório.
  </mat-error>
</mat-form-field>


      <!-- EMAIL -->
      <mat-form-field appearance="outline" class="half-width spaced-field" required>
        <mat-label>Email</mat-label>
<input matInput type="email" [(ngModel)]="cliente.cliEmail" name="cliEmail" #cliEmail="ngModel" required email />
        <mat-error *ngIf="cliEmail.invalid && cliEmail.touched">Email inválido</mat-error>
      </mat-form-field>

    <!-- CPF -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>CPF</mat-label>
      <input
        matInput
        name="cliCpf"
        [(ngModel)]="cliente.cliCpf"
        #cliCpf="ngModel"
        maxlength="14"
        placeholder="000.000.000-00"
        required
        (input)="mascaraCpf()"
        autocomplete="off"
      />
      <mat-error *ngIf="cliCpf.invalid && cliCpf.touched">
        CPF obrigatório e deve estar no formato correto.
      </mat-error>
    </mat-form-field>

    <!-- Data de Nascimento -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Data de Nascimento</mat-label>
      <input
        matInput
        [matDatepicker]="picker"
        name="cliDataNascimento"
        [(ngModel)]="cliente.cliDataNascimento"
        #cliDataNascimento="ngModel"
        placeholder="DD/MM/AAAA"
        required
        [max]="maxDate"
        autocomplete="off"
      />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
      <mat-error *ngIf="cliDataNascimento.invalid && cliDataNascimento.touched">
        Data inválida ou maior que a data atual.
      </mat-error>
    </mat-form-field>

    <!-- Telefone -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Telefone</mat-label>
      <input
        matInput
        name="cliTelefone"
        [(ngModel)]="cliente.cliTelefone"
        #cliTelefone="ngModel"
        required
        maxlength="15"
        placeholder="(00) 00000-0000"
        (input)="mascaraTelefone()"
        autocomplete="off"
      />
      <mat-error *ngIf="cliTelefone.invalid && cliTelefone.touched">
        Telefone obrigatório.
      </mat-error>
    </mat-form-field>

    <!-- Email -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>Email</mat-label>
      <input
        matInput
        type="email"
        name="cliEmail"
        [(ngModel)]="cliente.cliEmail"
        #cliEmail="ngModel"
        required
        email
        autocomplete="off"
      />
      <mat-error *ngIf="cliEmail.invalid && cliEmail.touched">
        Email inválido.
      </mat-error>
    </mat-form-field>

    <!-- CEP -->
    <mat-form-field appearance="outline" class="half-width" required>
      <mat-label>CEP</mat-label>
      <input
        matInput
        name="cep"
        [(ngModel)]="cep"
        #cepInput="ngModel"
        maxlength="9"
        placeholder="00000-000"
        (input)="onCepInput()"
        (keypress)="apenasNumerosComMascaraCep($event)"
        required
        autocomplete="off"
      />
      <mat-error *ngIf="cepInvalido">
        CEP inválido ou não encontrado.
      </mat-error>
    </mat-form-field>

  <div class="manual-address-button-container spaced-field" 
     *ngIf="!mostrarEnderecoManual && (!cep || cep.trim() === '')">
  <button mat-stroked-button color="warn" (click)="ativarEnderecoManual()">
    Não sei o CEP
  </button>
</div>  



   <!-- Campos endereço automático -->
<div *ngIf="!mostrarEnderecoManual && cliente.rua && cliente.bairro && cliente.cidade && cliente.estado" class="linha-campos">

  <mat-form-field appearance="outline" class="half-width spaced-field" disabled>
    <mat-label>Estado</mat-label>
    <input matInput [value]="cliente.estado" disabled />
  </mat-form-field>

  <mat-form-field appearance="outline" class="half-width spaced-field" disabled>
    <mat-label>Cidade</mat-label>
    <input matInput [value]="cliente.cidade" disabled />
  </mat-form-field>

  <mat-form-field appearance="outline" class="half-width spaced-field" disabled>
    <mat-label>Bairro</mat-label>
    <input matInput [value]="cliente.bairro" disabled />
  </mat-form-field>

  <mat-form-field appearance="outline" class="half-width spaced-field" disabled>
    <mat-label>Rua</mat-label>
    <input matInput [value]="cliente.rua" disabled />
  </mat-form-field>

  <mat-form-field appearance="outline" class="half-width spaced-field" required>
    <mat-label>Número</mat-label>
    <input matInput type="number" min="0" [(ngModel)]="cliente.numero" name="numero" #numero="ngModel" required />
    <mat-error *ngIf="numero.invalid && numero.touched">Número obrigatório e não pode ser negativo</mat-error>
  </mat-form-field>

</div>

<!-- Campos endereço manual -->
<div *ngIf="mostrarEnderecoManual" class="manual-address-fields">

  <mat-form-field appearance="outline" class="half-width spaced-field" required>
    <mat-label>Estado</mat-label>
    <mat-select [(ngModel)]="cliente.estado" name="estado" #estado="ngModel" required (selectionChange)="onEstadoChange($event.value)">
      <mat-option *ngFor="let estado of estadosECidades" [value]="estado.nome">{{ estado.nome }}</mat-option>
    </mat-select>
    <mat-error *ngIf="estado.invalid && estado.touched">Estado é obrigatório</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline" class="half-width spaced-field" required>
    <mat-label>Cidade</mat-label>
    <mat-select [(ngModel)]="cliente.cidade" name="cidade" #cidade="ngModel" required (selectionChange)="onCidadeSelecionada($event.value)">
      <mat-option *ngFor="let cidade of cidadesFiltradas" [value]="cidade">{{ cidade }}</mat-option>
    </mat-select>
    <mat-error *ngIf="cidade.invalid && cidade.touched">Cidade é obrigatória</mat-error>
  </mat-form-field>

 
  <mat-form-field *ngIf="mostrarCampoOutraCidade" appearance="outline" class="half-width spaced-field" required>
    <mat-label>Outra Cidade</mat-label>
<input
  matInput
  [(ngModel)]="nomeOutraCidade"
  name="nomeOutraCidade"
  #nomeOutraCidadeRef="ngModel"
  required
  (ngModelChange)="nomeOutraCidade = capitalizeWords($event)"
/>


    <mat-error *ngIf="nomeOutraCidadeRef.invalid && nomeOutraCidadeRef.touched">Informe a cidade</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline" class="half-width spaced-field" required>
    <mat-label>Rua</mat-label>
    <input matInput [(ngModel)]="cliente.rua" name="rua" #rua="ngModel" required pattern="^[A-Za-zÀ-ÿ\s]+$" (keydown)="bloquearNumeros($event)" (ngModelChange)="capitalizeFirst($event, 'rua')" />
    <mat-error *ngIf="rua.invalid && rua.touched">Informe apenas letras e espaços</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline" class="half-width spaced-field" required>
    <mat-label>Número</mat-label>
    <input matInput type="number" min="0" [(ngModel)]="cliente.numero" name="numero" #numeroManual="ngModel" required />
    <mat-error *ngIf="numeroManual.invalid && numeroManual.touched">Número obrigatório e não pode ser negativo</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline" class="half-width spaced-field">
    <mat-label>Bairro</mat-label>
    <input matInput [(ngModel)]="cliente.bairro" name="bairro" #bairro="ngModel" pattern="^[A-Za-zÀ-ÿ\s]+$" (ngModelChange)="capitalizeFirst($event, 'bairro')" />
    <mat-error *ngIf="bairro.invalid && bairro.touched">Informe apenas letras e espaços</mat-error>
  </mat-form-field>

  <!-- Botão "Voltar ao CEP" só aparece aqui, no modo manual -->
  <div class="manual-address-button-container spaced-field">
    <button mat-stroked-button color="primary" (click)="desativarEnderecoManual()">Voltar ao CEP</button>
  </div>
</div>



  <!-- Botões -->
  <div class="button-container">
    <button mat-raised-button color="primary" (click)="salvar()">Salvar</button>
    <button mat-raised-button color="warn" (click)="cancel()">Cancelar</button>
    <button mat-raised-button color="blue" (click)="limpar()">Limpar</button>
  </div>

  </form>
</mat-card>
</div>