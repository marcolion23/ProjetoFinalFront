<div class="container-geral">
  <mat-card class="client-card">

    <mat-card-title class="titulo-formulario">Cadastro de Pagamento</mat-card-title>

    <form class="client-form" #formPagamento="ngForm">

      <!-- TIPO DE PAGAMENTO -->
      <mat-form-field appearance="outline" class="half-width">
        <mat-label>Tipo</mat-label>
        <mat-select [(ngModel)]="formaPagamento.tipo" name="tipo" required (selectionChange)="onTipoPagamentoChange($event.value)">
          <mat-option value="Dinheiro">Dinheiro</mat-option>
          <mat-option value="Cartão de Crédito">Cartão de Crédito</mat-option>
          <mat-option value="Cartão de Débito">Cartão de Débito</mat-option>
          <mat-option value="Pix">Pix</mat-option>
          <mat-option value="Boleto">Boleto</mat-option>
          <mat-option value="Outro">Outro</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- VALOR -->
      <mat-form-field appearance="outline" class="half-width">
        <mat-label>Valor</mat-label>
        <input
          matInput
          type="text"
          [value]="valorFormatado"
          (input)="onValorInput($event)"
          name="valor"
          required
          placeholder="0,00"
        >
      </mat-form-field>

      <!-- APARECE SOMENTE PARA CARTÃO DE CRÉDITO -->
      <ng-container *ngIf="formaPagamento.tipo === 'Cartão de Crédito'">

        <!-- Parcelado? -->
        <mat-label class="subtitle">Parcelado?</mat-label>
        <mat-radio-group [(ngModel)]="formaPagamento.parcelado" name="parcelado" aria-label="Parcelado?" class="radio-group">
          <mat-radio-button value="sim">Sim</mat-radio-button>
          <mat-radio-button value="nao">Não</mat-radio-button>
        </mat-radio-group>

        <!-- Número de Parcelas (se parcelado = sim) -->
        <mat-form-field appearance="outline" class="half-width" *ngIf="formaPagamento.parcelado === 'sim'">
          <mat-label>Parcelas</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="formaPagamento.parcelas"
            name="parcelas"
            placeholder="1"
            min="1"
            max="36"
            (keydown)="bloquearTeclasInvalidas($event)"
          >
        </mat-form-field>

        <!-- Aplicar taxas? Sempre aparece -->
        <mat-label class="subtitle" style="margin-top: 16px;">Aplicar taxas?</mat-label>
        <mat-radio-group [(ngModel)]="formaPagamento.aplicarTaxas" name="aplicarTaxas" aria-label="Aplicar taxas?" class="radio-group">
          <mat-radio-button value="sim">Sim</mat-radio-button>
          <mat-radio-button value="nao">Não</mat-radio-button>
        </mat-radio-group>

        <!-- Porcentagem da taxa (se aplicarTaxas = sim) -->
        <mat-form-field appearance="outline" class="half-width" *ngIf="formaPagamento.aplicarTaxas === 'sim'">
          <mat-label>Porcentagem da Taxa (%)</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="formaPagamento.porcentagemTaxa"
            name="porcentagemTaxa"
            placeholder="Ex: 2.5"
            min="0"
            max="100"
            step="0.01"
          >
        </mat-form-field>

      </ng-container>

      <!-- STATUS -->
      <mat-form-field appearance="outline" class="half-width">
        <mat-label>Status</mat-label>
        <mat-select [(ngModel)]="formaPagamento.status" name="status" required>
          <mat-option value="Pendente">Pendente</mat-option>
          <mat-option value="Pago">Pago</mat-option>
          <mat-option value="Cancelado">Cancelado</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- OBSERVAÇÕES -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Observações</mat-label>
        <textarea matInput rows="4" [(ngModel)]="formaPagamento.observacao" name="observacao" placeholder="Anotações adicionais"></textarea>
      </mat-form-field>

      <!-- BOTÕES -->
      <div class="button-container">
        <button mat-raised-button color="primary" (click)="createFormaPagamento()" [disabled]="formPagamento.invalid">Salvar</button>
        <button mat-raised-button color="warn" (click)="cancel()">Cancelar</button>
        <button mat-raised-button color="accent" type="button" (click)="limpar()">Limpar</button>
      </div>

    </form>

  </mat-card>
</div>
