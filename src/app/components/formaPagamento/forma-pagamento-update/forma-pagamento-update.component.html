<div class="container-geral">
  <mat-card class="client-card">

    <mat-card-title class="titulo-formulario">ATUALIZAR FORMA DE PAGAMENTO</mat-card-title>

    <form class="client-form" #formPagamento="ngForm">

      <!-- DESCRIÇÃO -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Descrição</mat-label>
        <input matInput [(ngModel)]="formaPagamento.fpgDescricao" name="fpgDescricao" required>
      </mat-form-field>

      <!-- TIPO -->
      <mat-form-field appearance="outline" class="half-width">
        <mat-label>Tipo</mat-label>
        <mat-select [(ngModel)]="formaPagamento.fpgTipo" name="fpgTipo" required>
          <mat-option value="Dinheiro">
            <mat-icon inline>attach_money</mat-icon> Dinheiro
          </mat-option>
          <mat-option value="Cartão de Crédito">
            <mat-icon inline>credit_card</mat-icon> Cartão de Crédito
          </mat-option>
          <mat-option value="Cartão de Débito">
            <mat-icon inline>payment</mat-icon> Cartão de Débito
          </mat-option>
          <mat-option value="Pix">
            <mat-icon inline>qr_code</mat-icon> Pix
          </mat-option>
          <mat-option value="Boleto">
            <mat-icon inline>receipt</mat-icon> Boleto
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- MOSTRAR SOMENTE SE FOR CARTÃO DE CRÉDITO -->
      <ng-container *ngIf="formaPagamento.fpgTipo === 'Cartão de Crédito'">

        <!-- PARCELADO? -->
        <div class="full-width radio-section">
          <label class="subtitle">Parcelado?</label>
          <div class="radio-button-group">
            <button type="button" class="sim-btn"
              [class.selected]="formaPagamento.fpgNumMaxParcelas === 'sim'"
              (click)="formaPagamento.fpgNumMaxParcelas = 'sim'">Sim</button>

            <button type="button" class="nao-btn"
              [class.selected]="formaPagamento.fpgNumMaxParcelas === 'nao'"
              (click)="formaPagamento.fpgNumMaxParcelas = 'nao'">Não</button>
          </div>
          <p *ngIf="formaPagamento.fpgNumMaxParcelas === 'nao'" class="mensagem-alerta">
            Não será aplicado parcelamento.
          </p>
        </div>

      <!-- NÚMERO DE PARCELAS -->
<mat-form-field appearance="outline" class="half-width"
  *ngIf="formaPagamento?.fpgNumMaxParcelas === 'sim'">
  <mat-label>Parcelas</mat-label>
  <input 
    matInput 
    type="number" 
    [(ngModel)]="formaPagamento.fpgPermiteParcelamento"
    name="fpgPermiteParcelamento" 
    min="1" 
    max="24" 
    required
  >
<mat-error *ngIf="parcelasInvalidas">
  O número de parcelas deve estar entre 1 e 24.
</mat-error>


</mat-form-field>

        <!-- TAXA ADICIONAL -->
        <div class="full-width radio-section">
          <label class="subtitle">Aplicar taxas?</label>
          <div class="radio-button-group">
            <button type="button" class="sim-btn"
              [class.selected]="formaPagamento.fpgTaxaAdicional === 'sim'"
              (click)="formaPagamento.fpgTaxaAdicional = 'sim'">Sim</button>

            <button type="button" class="nao-btn"
              [class.selected]="formaPagamento.fpgTaxaAdicional === 'nao'"
              (click)="formaPagamento.fpgTaxaAdicional = 'nao'">Não</button>
          </div>
          <p *ngIf="formaPagamento.fpgTaxaAdicional === 'nao'" class="mensagem-alerta">
            Não será aplicada nenhuma taxa.
          </p>
        </div>

        <!-- PERCENTUAL DA TAXA (somente se sim) -->
        <mat-form-field appearance="outline" class="half-width" *ngIf="formaPagamento.fpgTaxaAdicional === 'sim'">
          <mat-label>Porcentagem da Taxa</mat-label>
          <input matInput type="text" maxlength="4" [(ngModel)]="porcentagemText" name="porcentagemTaxa" placeholder="Ex: 5%">
        </mat-form-field>

      </ng-container>

      <!-- BOTÕES -->
      <div class="button-container">
        <button mat-raised-button color="primary" (click)="atualizarPagamento()">Atualizar</button>
        <button mat-raised-button color="warn" (click)="cancelarEdicao()">Cancelar</button>
        <button mat-raised-button (click)="limparFormulario()">Limpar</button>
      </div>

    </form>
  </mat-card>
</div>
